{"ast":null,"code":"var _jsxFileName = \"/Users/mojib2014/Desktop/projects/blog-client/src/components/forms/topicForm.jsx\";\nimport React from \"react\";\nimport { NavLink } from \"react-router-dom\";\nimport Joi from \"joi-browser\";\nimport { toast } from \"react-toastify\";\nimport auth from \"../../services/auth\";\nimport Form from \"../common/form\";\nimport Footer from \"../footer\";\nimport FileInput from \"../common/fileInput\";\nimport topicService from \"../../services/topicService\";\nimport UserContext from \"../../context/userContext\";\nimport userService from \"../../services/userService\";\nimport SocialIcons from \"../socialIcon\";\nimport \"../../assets/css/topicForm.css\";\n\nclass TopicForm extends Form {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      data: {\n        title: \"\",\n        description: \"\"\n      },\n      file: null,\n      uploadedFile: null,\n      filename: \"Chose File\",\n      errors: {}\n    };\n    this.schema = {\n      title: Joi.string().min(5).required().label(\"Title\"),\n      description: Joi.string().min(5).required().label(\"Description\")\n    };\n\n    this.doSubmit = async () => {\n      const {\n        data,\n        uploadedFile\n      } = this.state;\n      const user = await auth.getCurrentUser();\n      const topic = {\n        title: data.title,\n        description: data.description,\n        imageUrl: uploadedFile.filepath,\n        author: user._id,\n        createdAt: Date.now()\n      };\n\n      try {\n        user.publications++;\n        await userService.updateUser(user);\n        await topicService.createTopic(topic);\n      } catch (err) {\n        toast.info(err.response.data);\n      }\n\n      window.location = \"/topics\";\n    };\n\n    this.changeHandler = e => {\n      e.preventDefault();\n      this.setState({\n        file: e.target.files[0],\n        filename: e.target.files[0].name,\n        loaded: 0\n      });\n    };\n\n    this.handlefileUpload = async e => {\n      e.preventDefault();\n\n      try {\n        const file = new FormData();\n        file.append(\"file\", this.state.file);\n        const {\n          data\n        } = await topicService.createFile(file, {\n          headers: {\n            \"Conent-type\": \"multipart/form-data\"\n          }\n        });\n        this.setState({\n          uploadedFile: {\n            filename: data.filename,\n            filepath: data.filepath\n          }\n        });\n        toast.success(\"Successfuly uploaded\");\n      } catch (err) {\n        if (err.response && err.response.status === 500) {\n          toast.error(\"Something failed\");\n        } else {\n          toast.error(err.response.data.msg);\n        }\n      }\n    };\n  }\n\n  render() {\n    const {\n      filename\n    } = this.state;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(SocialIcons, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(UserContext.Consumer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }\n    }, user => user && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"topic-form-div\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 19\n      }\n    }, \"Topic Form\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(FileInput, {\n      onClick: this.handlefileUpload,\n      onChange: this.changeHandler,\n      filename: filename,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 21\n      }\n    }), this.renderInput(\"title\", \"Title\", \"text\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 21\n      }\n    }, \"Please format your comment with markdown.\", \" \", /*#__PURE__*/React.createElement(NavLink, {\n      id: \"markdown-cheat-sheet\",\n      target: \"_blank\",\n      to: {\n        pathname: \"https://www.markdownguide.org/cheat-sheet/\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 23\n      }\n    }, \"Markdwon Cheat Sheet.\")), this.renderTextArea(\"description\", \"Description\", \"Please format your comment with markdown.\", 4, \"text\"), this.renderButton(\"Submit\"))), /*#__PURE__*/React.createElement(Footer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 17\n      }\n    }))));\n  }\n\n}\n\nexport default TopicForm;","map":{"version":3,"sources":["/Users/mojib2014/Desktop/projects/blog-client/src/components/forms/topicForm.jsx"],"names":["React","NavLink","Joi","toast","auth","Form","Footer","FileInput","topicService","UserContext","userService","SocialIcons","TopicForm","state","data","title","description","file","uploadedFile","filename","errors","schema","string","min","required","label","doSubmit","user","getCurrentUser","topic","imageUrl","filepath","author","_id","createdAt","Date","now","publications","updateUser","createTopic","err","info","response","window","location","changeHandler","e","preventDefault","setState","target","files","name","loaded","handlefileUpload","FormData","append","createFile","headers","success","status","error","msg","render","handleSubmit","renderInput","pathname","renderTextArea","renderButton"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { NavLink } from \"react-router-dom\";\nimport Joi from \"joi-browser\";\nimport { toast } from \"react-toastify\";\n\nimport auth from \"../../services/auth\";\nimport Form from \"../common/form\";\nimport Footer from \"../footer\";\nimport FileInput from \"../common/fileInput\";\nimport topicService from \"../../services/topicService\";\nimport UserContext from \"../../context/userContext\";\nimport userService from \"../../services/userService\";\nimport SocialIcons from \"../socialIcon\";\n\nimport \"../../assets/css/topicForm.css\";\n\nclass TopicForm extends Form {\n  state = {\n    data: { title: \"\", description: \"\" },\n    file: null,\n    uploadedFile: null,\n    filename: \"Chose File\",\n    errors: {},\n  };\n\n  schema = {\n    title: Joi.string().min(5).required().label(\"Title\"),\n    description: Joi.string().min(5).required().label(\"Description\"),\n  };\n\n  doSubmit = async () => {\n    const { data, uploadedFile } = this.state;\n    const user = await auth.getCurrentUser();\n    const topic = {\n      title: data.title,\n      description: data.description,\n      imageUrl: uploadedFile.filepath,\n      author: user._id,\n      createdAt: Date.now(),\n    };\n    try {\n      user.publications++;\n      await userService.updateUser(user);\n      await topicService.createTopic(topic);\n    } catch (err) {\n      toast.info(err.response.data);\n    }\n    window.location = \"/topics\";\n  };\n\n  changeHandler = (e) => {\n    e.preventDefault();\n    this.setState({\n      file: e.target.files[0],\n      filename: e.target.files[0].name,\n      loaded: 0,\n    });\n  };\n\n  handlefileUpload = async (e) => {\n    e.preventDefault();\n    try {\n      const file = new FormData();\n      file.append(\"file\", this.state.file);\n      const { data } = await topicService.createFile(file, {\n        headers: {\n          \"Conent-type\": \"multipart/form-data\",\n        },\n      });\n      this.setState({\n        uploadedFile: {\n          filename: data.filename,\n          filepath: data.filepath,\n        },\n      });\n      toast.success(\"Successfuly uploaded\");\n    } catch (err) {\n      if (err.response && err.response.status === 500) {\n        toast.error(\"Something failed\");\n      } else {\n        toast.error(err.response.data.msg);\n      }\n    }\n  };\n\n  render() {\n    const { filename } = this.state;\n    return (\n      <>\n        <SocialIcons />\n        <UserContext.Consumer>\n          {(user) =>\n            user && (\n              <>\n                <div className=\"topic-form-div\">\n                  <h1>Topic Form</h1>\n                  <form onSubmit={this.handleSubmit}>\n                    <FileInput\n                      onClick={this.handlefileUpload}\n                      onChange={this.changeHandler}\n                      filename={filename}\n                    />\n                    {this.renderInput(\"title\", \"Title\", \"text\")}\n                    <p>\n                      Please format your comment with markdown.{\" \"}\n                      <NavLink\n                        id=\"markdown-cheat-sheet\"\n                        target=\"_blank\"\n                        to={{\n                          pathname:\n                            \"https://www.markdownguide.org/cheat-sheet/\",\n                        }}\n                      >\n                        Markdwon Cheat Sheet.\n                      </NavLink>\n                    </p>\n                    {this.renderTextArea(\n                      \"description\",\n                      \"Description\",\n                      \"Please format your comment with markdown.\",\n                      4,\n                      \"text\"\n                    )}\n                    {this.renderButton(\"Submit\")}\n                  </form>\n                </div>\n                <Footer />\n              </>\n            )\n          }\n        </UserContext.Consumer>\n      </>\n    );\n  }\n}\n\nexport default TopicForm;\n"]},"metadata":{},"sourceType":"module"}